{"version":3,"sources":["loginSys.js"],"names":["loginSys","loginToServer","successCallBack","paras","networkMgrNode","cc","find","networkMgr","getComponent","ipconfig","json","ip","port","url","sys","platform","WECHAT_GAME","wx","login","success","res","code","message","token","JSON","stringify","sendMessageToServer","loginSucess","console","log","xhr","others","playerId","responseText","Number","dataCenter","require","playerData","id","module","exports"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAIA,WAAW;AAEXC,iBAFW,yBAEGC,eAFH,EAEgC;AAAA,YAAbC,KAAa,uEAAL,IAAK;;AACvC,YAAIC,iBAAiBC,GAAGC,IAAH,CAAQ,gBAAR,CAArB;AACA,YAAIC,aAAaH,eAAeI,YAAf,CAA4B,YAA5B,CAAjB;AACA,YAAIC,WAAWF,WAAWE,QAAX,CAAoBC,IAAnC;AACA,YAAIC,KAAKF,SAASE,EAAlB;AACA,YAAIC,OAAOH,SAASG,IAApB;;AAGA,YAAIC,MAAM,YAAYF,EAAZ,GAAiB,GAAjB,GAAuBC,IAAvB,GAA8B,GAAxC;AACA,YAAIP,GAAGS,GAAH,CAAOC,QAAP,IAAmBV,GAAGS,GAAH,CAAOE,WAA9B,EAA2C;AACvCC,eAAGC,KAAH,CAAS;AACLC,uBADK,mBACGC,GADH,EACO;AACR,wBAAIC,OAAOD,IAAIC,IAAf;AACA,wBAAIA,IAAJ,EAAU;AACN,4BAAIC,UAAU;AACVC,mCAAOF;AADG,yBAAd;AAGAC,kCAAUE,KAAKC,SAAL,CAAeH,OAAf,CAAV;AACAf,mCAAWmB,mBAAX,CAA+Bd,IAA/B,EAAoCC,GAApC,EAAwCS,OAAxC,EAAgD,KAAKK,WAArD,EAAiE,YAAU,CAAE,CAA7E,EAA8E,CAACzB,eAAD,EAAiBC,KAAjB,CAA9E;AACH,qBAND,MAOK;AACDyB,gCAAQC,GAAR,CAAY,8BAAZ;AACH;AACJ;AAbI,aAAT;AAeH,SAhBD,MAiBK;AACD,gBAAIP,UAAU;AACVC,uBAAO;AADG,aAAd;AAGAD,sBAAUE,KAAKC,SAAL,CAAeH,OAAf,CAAV;AACAf,uBAAWmB,mBAAX,CAA+Bd,IAA/B,EAAoCC,GAApC,EAAwCS,OAAxC,EAAgD,KAAKK,WAArD,EAAiE,YAAU,CAAE,CAA7E,EAA8E,CAACzB,eAAD,EAAiBC,KAAjB,CAA9E;AACH;AAEJ,KApCU;AAqCXwB,eArCW,uBAqCCG,GArCD,EAqCKC,MArCL,EAqCa;AACpB,YAAIC,WAAWF,IAAIG,YAAnB;AACAD,mBAAWE,OAAOF,QAAP,CAAX;AACA,YAAIG,aAAaC,QAAQ,YAAR,CAAjB;AACA;AACAD,mBAAWE,UAAX,GAAwB;AACpBC,gBAAIN;AADgB,SAAxB;AAGA,YAAI9B,kBAAkB6B,OAAO,CAAP,CAAtB;AACA,YAAI5B,QAAQ4B,OAAO,CAAP,CAAZ;AACA7B,wBAAgBC,KAAhB;AACH;AAhDU,CAAf;;AAoDAoC,OAAOC,OAAP,GAAiBxC,QAAjB","file":"loginSys.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nvar loginSys = {\n\n    loginToServer(successCallBack,paras = null){\n        var networkMgrNode = cc.find(\"networkMgrNode\");\n        var networkMgr = networkMgrNode.getComponent(\"networkMgr\");\n        var ipconfig = networkMgr.ipconfig.json;\n        var ip = ipconfig.ip;\n        var port = ipconfig.port;\n\n\n        var url = \"http://\" + ip + \":\" + port + \"/\";\n        if (cc.sys.platform == cc.sys.WECHAT_GAME) {\n            wx.login({\n                success(res){\n                    var code = res.code;\n                    if (code) {\n                        var message = {\n                            token: code\n                        }\n                        message = JSON.stringify(message);\n                        networkMgr.sendMessageToServer(port,url,message,this.loginSucess,function(){},[successCallBack,paras]);\n                    }\n                    else {\n                        console.log(\"wechat get login code failed\");\n                    }\n                }\n            })\n        }\n        else {\n            var message = {\n                token: \"houwan&12313\"\n            }\n            message = JSON.stringify(message)\n            networkMgr.sendMessageToServer(port,url,message,this.loginSucess,function(){},[successCallBack,paras]);\n        }\n        \n    },\n    loginSucess(xhr,others) {\n        var playerId = xhr.responseText;\n        playerId = Number(playerId);\n        var dataCenter = require(\"dataCenter\");\n        //dataCenter.playerData.id = playerId;\n        dataCenter.playerData = {\n            id: playerId\n        }\n        var successCallBack = others[0];\n        var paras = others[1];\n        successCallBack(paras);\n    }\n    \n}\n\nmodule.exports = loginSys;\n"]}